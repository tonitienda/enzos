package vga

import "testing"

func TestExtractCharactersIgnoresAddresses(t *testing.T) {
	dump := `QEMU 8.2.0 monitor - type 'help' for more information
(qemu) xp /4000bx 0xb8000
00000000000b8000: 0x45 0x07 0x6e 0x07 0x7a 0x07 0x4f 0x07 0x53 0x07 0x20 0x07 0x62 0x07 0x6f 0x07 0x6f 0x07 0x74 0x07 0x65 0x07
0x64 0x07 0x20 0x07 0x73 0x07 0x75 0x07
00000000000b801e: 0x63 0x07 0x63 0x07 0x65 0x07 0x73 0x07 0x73 0x07 0x66 0x07 0x75 0x07 0x6c 0x07 0x6c 0x07 0x79 0x07 0x2e 0x07
0x00 0x07`

	got, err := ExtractCharacters(dump)
	if err != nil {
		t.Fatalf("ExtractCharacters returned error: %v", err)
	}

	const want = "EnzOS booted successfully."
	if got != want {
		t.Fatalf("unexpected text: got %q want %q", got, want)
	}
}

func TestExtractCharactersToleratesAttributeFirst(t *testing.T) {
	dump := `QEMU 8.2.0 monitor - type 'help' for more information
(qemu) xp /4000bx 0xb8000
00000000000b8000: 0x07 0x45 0x07 0x6e 0x07 0x7a 0x07 0x4f 0x07 0x53 0x07 0x20 0x07 0x62 0x07 0x6f 0x07 0x6f 0x07 0x74 0x07 0x65 0x07
0x64 0x07 0x20 0x07 0x73 0x07 0x75 0x07
00000000000b801e: 0x07 0x63 0x07 0x63 0x07 0x65 0x07 0x73 0x07 0x73 0x07 0x66 0x07 0x75 0x07 0x6c 0x07 0x6c 0x07 0x79 0x07 0x2e 0x07
0x00 0x07`

	got, err := ExtractCharacters(dump)
	if err != nil {
		t.Fatalf("ExtractCharacters returned error: %v", err)
	}

	const want = "EnzOS booted successfully."
	if got != want {
		t.Fatalf("unexpected text: got %q want %q", got, want)
	}
}
